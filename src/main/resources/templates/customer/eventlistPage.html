<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" >
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="/css/style.css">
    <script>
        function reloadEventList(eventNumber) {
            const url = "/api/event/eventListPage";

            fetch(url)
            .then(response => response.json())
            .then(response => {
                const EventList = document.getElementById("templete");
                EventList.innerHTML = "";

                const eventTemplate = document.querySelector(".EventList");

                for(e of response.runningEventInfoList){
                    console.log(e);
                    const newEventTemplate = eventTemplate.cloneNode(true);
                    const mainImage = newEventTemplate.querySelector(".mainImg");
                    mainImage.src = "/images/" + e.eventBoardDto.eventMainImage;

                    const detailPage = newEventTemplate.querySelector(".detailPage");
                    detailPage.href = detailPage.href + "?eventNumber="+ e.eventBoardDto.eventNumber;

                    const detailPageNumber = newEventTemplate.querySelector(".detailPageNumber");
                    detailPageNumber.value = e.eventBoardDto.eventNumber;

                    const eventBoardLikeCount = newEventTemplate.querySelector(".eventBoardLikeCount");
                    eventBoardLikeCount.textContent = e.eventBoardLikeCount;

                    const thumbsUp = newEventTemplate.querySelector(".thumbsUp");
                    if(e.eventLikeCustomerCheck == 1 ){
                         thumbsUp.classList.remove("bi-hand-thumbs-up");
                         thumbsUp.classList.add("bi-hand-thumbs-up-fill");
                    }
                    else{
                         thumbsUp.classList.remove("bi-hand-thumbs-up-fill");
                         thumbsUp.classList.add("bi-hand-thumbs-up");
                    }


                    EventList.appendChild(newEventTemplate);
                    eventTemplate.classList.remove("d-none");
                }
            })

        }

        function endEventList(){
            const url = "/api/event/eventListPage";

            fetch(url)
            .then(response => response.json())
            .then(response => {
                const endEventList = document.getElementById("templete");
                endEventList.innerHTML = "";

                const eventTemplate = document.querySelector(".endEventList");

                for(e of response.endEventInfoList){
                    console.log(e);
                    const newEventTemplate = eventTemplate.cloneNode(true);
                    const mainImage = newEventTemplate.querySelector(".mainImg");
                    mainImage.src = "/images/" + e.eventBoardDto.eventMainImage;

                    const detailPage = newEventTemplate.querySelector(".detailPage");
                    detailPage.href = detailPage.href + "?eventNumber="+ e.eventBoardDto.eventNumber;

                    const detailPageNumber = newEventTemplate.querySelector(".detailPageNumber");
                    detailPageNumber.value = e.eventBoardDto.eventNumber;

                    const eventBoardLikeCount = newEventTemplate.querySelector(".eventBoardLikeCount");
                    eventBoardLikeCount.textContent = e.eventBoardLikeCount;

                    const thumbsUp = newEventTemplate.querySelector(".thumbsUp");
                    if(e.eventLikeCustomerCheck == 1 ){
                         thumbsUp.classList.remove("bi-hand-thumbs-up");
                         thumbsUp.classList.add("bi-hand-thumbs-up-fill");
                    }
                    else{
                         thumbsUp.classList.remove("bi-hand-thumbs-up-fill");
                         thumbsUp.classList.add("bi-hand-thumbs-up");
                    }


                    endEventList.appendChild(newEventTemplate);

                }
            })
        }


        function likeDislike(eventBoardLikeCount,eventNumber){
              const url = "/api/event/insertDeleteLikeProcess?eventNumber="+eventNumber;

              fetch(url)
              .then(response => response.json())
              .then(response => {
                  const likeCount = document.querySelector("likeCount");
                  if(response.loginSuccess === "false"){
                    window.location.href="/login/customerLogin";
                  }
              })
              reloadEventList();
        }


        function likeDislikeTwo(eventBoardLikeCount,eventNumber){
              const url = "/api/event/insertDeleteLikeProcess?eventNumber="+eventNumber;

              fetch(url)
              .then(response => response.json())
              .then(response => {
                  const likeCount = document.querySelector("likeCount");
                  if(response.loginSuccess === "false"){
                    window.location.href="/login/customerLogin";
                  }
              })
              endEventList();
        }

        function likeDisLikeProcess(target){
            const location = target.closest(".EventList");
            const eventBoardLikeCount = location.querySelector(".eventBoardLikeCount");
            const detailPageNumber = location.querySelector(".detailPageNumber").value;

            likeDislike(eventBoardLikeCount,detailPageNumber)

        }

        function likeDisLikeProcessTwo(target){
            const location = target.closest(".endEventList");
            const eventBoardLikeCount = location.querySelector(".eventBoardLikeCount");
            const detailPageNumber = location.querySelector(".detailPageNumber").value;

            likeDislikeTwo(eventBoardLikeCount,detailPageNumber)

        }

        window.addEventListener("DOMContentLoaded", () => {
                reloadEventList();
            });
    </script>
</head>
<div th:replace="common/customerNavi::bottomNavi"></div>

<div class="container">
    <div class="row" style="margin-bottom:82px;">
        <div class="col mt-3">
            <div class="row">
                <div class="col text-center">
                    <span class="fw-bolder">이벤트</span>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <ul class="nav nav-underline">
                        <li class="nav-item col-6 text-center">
                            <a onclick="reloadEventList()" class="link-underline link-underline-opacity-0 text-black nav-link">진행중인 이벤트</a>
                        </li>
                        <li class="nav-item col-5 text-center">
                            <a onclick="endEventList()" class="link-underline link-underline-opacity-0 text-black nav-link">종료된 이벤트</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="row px-4">
                    </div>
                </div>
                <div class="col">
                    <div class="row">
                        <div class="col"></div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div class="row mt-3">
                        <div class="col" id="templete">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!--이벤트 목록 나오도록-->
<div class="d-none">
    <div class="EventList row mb-2 ">
        <div class="col">
            <div class="row">
                <div class="col">
                    <a class="detailPage" href="eventDetailPage"><img class="mainImg img-fluid"></a>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <input type="hidden" class="detailPageNumber">
                    <i onclick="likeDisLikeProcessTwo(this)" class="thumbsUp bi bi-hand-thumbs-up"></i>
                    <span class="eventBoardLikeCount"></span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="d-none">
    <div class="endEventList row mb-2 ">
        <div class="col">
            <div class="row">
                <div class="col">
                    <a class="detailPage" href="eventDetailPage"><img class="mainImg img-fluid"></a>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <input type="hidden" class="detailPageNumber">
                    <i onclick="likeDisLikeProcessTwo(this)" class="thumbsUp bi bi-hand-thumbs-up"></i>
                    <span class="eventBoardLikeCount"></span>
                </div>
            </div>
        </div>
    </div>
</div>




<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://kit.fontawesome.com/7b271bba58.js" crossorigin="anonymous"></script>
</body>
</html>